---
title: 相关问题及解决方法
date: 2023-08-11 17:58:23
categories: 资料
math:
tags:
sticky: 9999
---
<!-- TOC -->

- [遇到的一些问题和解决方法（持续更新！）:rainbow::rainbow::rainbow:](#遇到的一些问题和解决方法持续更新rainbowrainbowrainbow)
    - [第1周:rainbow:](#第1周rainbow)
    - [第2周:rainbow:](#第2周rainbow)
    - [第3周:rainbow:](#第3周rainbow)
    - [第4周:rainbow:](#第4周rainbow)
    - [第5周:rainbow:](#第5周rainbow)
    - [第6周:rainbow:](#第6周rainbow)

<!-- /TOC -->
## 遇到的一些问题和解决方法（持续更新！）:rainbow::rainbow::rainbow:
### 第1周:rainbow:
1. windows环境下安装pycocotools报错：ERROR: Could not build wheels for pycocotools, which is required to install pyproject.toml-based projects，解决方法：[1](https://blog.csdn.net/weixin_45775136/article/details/130248372?ops_request_misc=&request_id=&biz_id=102&utm_term=ERROR:%20Could%20not%20build%20wheels%20&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-2-130248372.nonecase&spm=1018.2226.3001.4187)
2. windows环境下安装mmcv库报错：ERROR:Could not build wheels for mmcv, which is required to install pyproject.toml-based projects，解决方法：先pip install openmim，然后mim install mmcv
3. 训练时出现OSError: [WinError 1455] 页面文件太小,无法完成操作，原因是dataloader的num_worker设置的太大，CPU线程不支持，解决方法：num_worker设置小一些即可
4. TarDAL代码中，检测部分yolov5s网络输出的结果shape不一致，解决办法：调试之后发现yolov5源码中会根据当前模式(train or eval)选择输出
5. MetaFusion论文并未提供详细代码，只提供了测试代码，因此无法得知网络具体的训练策略以及损失计算的详细过程。
6. 训练TarDAL时，自己训练的子模型无法加载到下一个子模型中，而论文提供的预训练模型却可以。解决方法：该篇论文提供的源码存在诸多问题，经过多番调试发现，自己训练的模型无法加载的原因是因为判别器模型linear层参数的size与当前判别器模型对应层参数size不匹配，而提供的预训练权重可以正常加载的原因是预训练权重只包含了生成器的权重，因此代码在加载预训练权重时没有加载判别器权重。进一步调试后发现，linear层参数size不匹配的原因是不同子模型训练时输入图片的大小不一致，导致后续子模型无法加载权重。
7. 训练时梯度回传时出现nan。解决方法：先检查数据有没有问题，没有问题则尝试将对应的学习率调低。

### 第2周:rainbow:
1. 执行sh脚本文件时出现找不到目录。解决方法：windows默认换行符是\r\n，linux下是\n，我在windows环境下使用vscode连接远程服务器时，使用的换行符依旧是\r\n，所以在执行cd时找不到目录，这时可以使用dos2unix命令来转换脚本文件。
2. OSError: cannot write mode F as PNG。解决方法：这里的 mode F 意思是图像中浮点类型的像素值，原因是代码中的 img 数组是 float 类型的，而图像中每个像素的值应该是 0-255(uint8 类型)。使用astype(np.uint8)转换数据类型即可。
3. 使用wandb时出错，wandb: ERROR Internal wandb error: file data was not synced。解决方法：该错误与protobuf库有关，卸载后重新安装即可解决。
4. detfusion在使用bash compile.sh编译mmdet时报错。解决方法：原因是因为python. cuda. pytorch版本过高导致的，安装python3.7. 切换cuda版本安装pytorch低版本1.3.1后解决。
5. 尝试运行detfusion时出现ModuleNotFoundError: No module named 'DOTA_devkit'。解决方法：安装swig，然后git下DOTA_devkit远程仓库，然后编译c++扩展。具体参考：(https://zhuanlan.zhihu.com/p/355862906)
6. 运行时报错ImportError: urllib3 v2.0 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'OpenSSL 1.0.2u。解决方法：urllib版本过高导致，安装对应版本的urllib即可。
7. 使用faster rcnn对detfusion的融合结果进行检测时，边界框回归损失出现nan。解决方法：起初认为是学习率过高导致，后来降低学习率无果后，怀疑是作者给的annotations存在问题，编写简单脚本进行检查后发现，有5张图片的gt存在问题，具体问题是xmin==xmax导致边界框回归计算出错，将出错的gt删除即可。
8. 部署模型时出现timm.layers未找到，timm更新后路径改变导致。解决方法：改为timm.models.layers
9. 使用lyngor编译模型时出现AttributeError: module 'torch' has no attribute 'get_autocast_gpu_dtype'。解决方法：这是因为pytorch版本过低导致，可以升级pytorch或者手动更改代码中的dtype，我通过本地高版本pytorch打印出该函数返回值，然后手动改为torch.half和torch.bfloat16
10. AttributeError: 'str' object has no attribute 'fromat'，解决方法：改成f-string形式。
11. ValueError: only one element tensors can be converted to Python scalars，解决方法：[1](https://blog.csdn.net/Vertira/article/details/127814093?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169372428616800225573433%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=169372428616800225573433&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~times_rank-2-127814093-null-null.142^v93^control&utm_term=ValueError%3A%20only%20one%20element%20tensors%20can%20be%20converted%20to%20Python%20scalars&spm=1018.2226.3001.4187)

### 第3周:rainbow:
1. python导入另一个文件夹下的包时提示找不到模块，如/a/aa.py的aa.py文件需要导入/b/bb.py文件，aa.py文件提示找不到bb模块。解决方法：需要在/b/文件夹下创建__init__.py，然后再aa.py中加入import sys,sys.path.append('..')，将上级目录添加到工作路径中。
2. ImportError: attempted relative import with no known parent package。解决方法：这个错误通常是由于相对导入的模块没有正确的父级包导致的，使用绝对导入即可解决。
3. 使用thop计算模型参数量时出现RuntimeError: module must have its parameters and buffers on device cuda:0 (device_ids[0]) but found one of them on device: cpu。解决方法：原因是nn.DataParallel()导致部分模型没有在同一张GPU上，使用单卡计算参数量和计算量即可。
4. 在改动CDDFuse代码时，使用params_group为不同参数设置学习率后，出现梯度为0，loss不变的情况。解决方法：经过排查是学习率太大导致，降低学习率即可。
5. 在使用FFT计算频谱的时候，使用torch.fft.ifftn将频谱逆变换回来，然后保存为图像时报错。解决办法：图像的数据需要转换为np.uint8类型，所以逆变换后需要将数据转换成np.uint8才能正常保存。
6. 将频域信息输入到卷积层时报错。解决方法：nn.Linear，nn.Conv2d等默认输入数据类型是torch.float32，频域数据是复数，所以需要将dtype改成torch.complex64即可解决。
7. 使用切片操作得到预测的滤波器时报错：RuntimeError: "div_floor_cuda" not implemented for 'ComplexFloat'。解决方法：该错误和数据类型有关，需要使用torch.abs将数据类型为torch.complex的数据转换一下。

### 第4周:rainbow:
1. 自己搭建的融合网络进行推理测试时报错：IndexError: invalid index of a 0-dim tensor. Use `tensor.item()` in Python or `tensor.item<T>()` in C++ to convert a 0-dim tensor to a number。解决方法：因为在推理时，batchsize为1，所以计算时出现了维度错误，将相应的和batch有关的计算进行更改即可。
2. 将ycbcr进行拼接转为rgb图像时，图像显示时色彩异常。解决方法：出现此情况的原因时读取ycbcr图像时，先分别读取出y，cbcr，然后在分别进行归一化，因为rgb2ycbcr的过程中涉及其他计算，所以应当先对整张图像归一化，再分别读取出y，cbcr。
3. 推理时报错TypeError: conv2d() received an invalid combination of arguments - got (tuple, Parameter, NoneType, tuple, tuple, tuple, int), but expected one of: * (Tensor input, Tensor weight, Tensor bias, tuple of ints stride, tuple of ints padding, tuple of ints dilation, int groups)didn't match because some of the arguments have invalid types: (tuple of (Tensor, Tensor), Parameter, NoneType, tuple of (int, int), tuple of (int, int), tuple of (int, int), int)。解决方法：原因是输入模型的数据有误，误把某个tuple类型的数据输入到一个本该为tensor的数据中。

### 第5周:rainbow:
1. 使用git push出现
error: 对象文件 .git/objects/f2/22d3b7ccb69f6a75af88129fa8ebc652a6d349 为空
error: 对象文件 .git/objects/f2/22d3b7ccb69f6a75af88129fa8ebc652a6d349 为空
fatal: 松散对象 f222d3b7ccb69f6a75af88129fa8ebc652a6d349（保存在 .git/objects/f2/22d3b7ccb69f6a75af88129fa8ebc652a6d349）已损坏
解决方法：是因为虚拟机强制退出引起的，按照网上的方法要find .git/objects/ -size 0 -exec rm -f {} \;
git fetch origin，但没有解决，应该将备份分支的.git文件夹复制到主目录，部署分支的.git放在.deploy_git
2. error: 源引用规格 main 没有匹配，解决方法，本地分支与远程分支名称不匹配，指定推送的远程分支名称即可。
3. vscode终端运行c++文件输出中文乱码，解决方法：原因是vscode文件编码为utf8而终端编码为gbk，因此需要把终端编码改为utf8，对于powershell，需要按ctrl+,然后在命令行后面加powershell.exe -NoExit chcp 65001，对于cmd，需要在注册表HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Command Processor新建字符串值，然后输入chcp 65001。或者在代码中，包含#include <windows.h>，然后在输出前加一行SetConsoleOutputCP(CP_UTF8);这样就可以正常输出中文了。

### 第6周:rainbow:
1. linux下运行sh脚本，命令行参数间自动增加\r，解决方法：dos2unix a.sh 或者 sed -i "s/\r//" a.sh，参考(https://blog.csdn.net/qq_25112523/article/details/109279059)
2. 安装tinycudann时报错ERROR: Could not build wheels for tinycudann, which is required to install pyproject.toml-based projects，此时还发现其他报错信息，The detected CUDA version (12.2) mismatches the version that was used to compile PyTorch (11.7). Please make sure to use the same CUDA versions.因此因该是版本不一致导致的，解决方法：切换cuda版本
3. UnboundLocalError: local variable 'dir' referenced before assignment。解决方法，我在使用if语句时，每个分支内定义了dir变量，然后函数返回dir时如果都不满足可能不认识，因此应在if语句前初始化一下dir变量
4. pip安装requirements失败，解决方法：不知道什么原因，需要先安装一个torch，继续安装requirements就正常了。
5. 装环境报错error in gym setup command: 'extras_require' must be a dictionary whose values are strings or lists of strings containing valid project/version requirement specifiers.。解决办法：pip install setuptools== 65.5.0 
pip install --user wheel==0.38.0
6. 安装环境时报错，Caused by SSLError(SSLZeroReturnError(6, 'TLS/SSL connection has been closed (EOF) (_ssl.c:1131)'))) - skipping解决方法：关闭系统代理
7. TypeError: Cannot handle this data type: (1, 1), < i8，解决方法，需要将图像数组转换成np.uint8